"0","library(TOSTER)"
"0","library(car)"
"2","필요한 패키지를 로딩중입니다: carData
"
"0","library(tibble)"
"0",""
"0","power_tost_from_data <- function(group1, group2,"
"0","                                 margin_sd = 1.5,"
"0","                                 alpha = 0.05,"
"0","                                 var.equal = NULL) {"
"0","  n1 <- length(group1)"
"0","  n2 <- length(group2)"
"0",""
"0","  mean1 <- mean(group1)"
"0","  mean2 <- mean(group2)"
"0","  var1 <- var(group1)"
"0","  var2 <- var(group2)"
"0","  delta <- mean1 - mean2  # raw difference"
"0",""
"0","  # Variance equality check"
"0","  if (is.null(var.equal)) {"
"0","    df_test <- data.frame(value = c(group1, group2),"
"0","                          group = factor(rep(c(""g1"", ""g2""), times = c(n1, n2))))"
"0","    p_var <- leveneTest(value ~ group, data = df_test)[1, ""Pr(>F)""]"
"0","    var_equal <- p_var > 0.05"
"0","  } else {"
"0","    var_equal <- var.equal"
"0","    p_var <- NA"
"0","  }"
"0",""
"0","  # Margin in raw units (absolute difference)"
"0","  ref_sd <- sd(group2)"
"0","  eqb_raw <- margin_sd * ref_sd  # ±1.5 SD (raw scale)"
"0",""
"0","  # Adjust RLD sample size (FDA guidance)"
"0","  n2_adj <- min(1.5 * n1, n2)"
"0",""
"0","  # Harmonic mean sample size for power estimation"
"0","  n_adj <- 2 / (1 / n1 + 1 / n2_adj)"
"0",""
"0","  # Pooled SD for power calculation"
"0","  if (var_equal) {"
"0","    pooled_sd <- sqrt(((n1 - 1)*var1 + (n2 - 1)*var2) / (n1 + n2 - 2))"
"0","  } else {"
"0","    pooled_sd <- sqrt((var1 + var2) / 2)  # conservative"
"0","  }"
"0",""
"0","  # Power estimation via TOSTER on raw scale"
"0","  power_result <- power_t_TOST("
"0","    n = n_adj,"
"0","    delta = delta,"
"0","    sd = pooled_sd,"
"0","    eqb = eqb_raw,"
"0","    alpha = alpha,"
"0","    type = ""two.sample"""
"0","  )"
"0",""
"0","  power_value <- power_result$power  # extract numeric"
"0",""
"0","  tibble("
"0","    mean_diff = round(delta, 4),"
"0","    pooled_sd = round(pooled_sd, 4),"
"0","    margin_raw = round(eqb_raw, 4),"
"0","    n1 = n1,"
"0","    n2_original = length(group2),"
"0","    n2_adj = round(n2_adj, 1),"
"0","    n_adj = round(n_adj, 1),"
"0","    var_equal = var_equal,"
"0","    variance_test_p = round(p_var, 4),"
"0","    variance_assumption = if (var_equal) {"
"0","      ""Equal variance assumed (Levene’s test p > 0.05)"""
"0","    } else {"
"0","      ""Unequal variance assumed (Levene’s test p <= 0.05, Welch’s df applied)"""
"0","    },"
"0","    power = round(power_value, 4)"
"0","  )"
"0","}"
"0",""
